import sys
import os
import utilsMatrix
from Motif import *

def helpProgram():
	print "\nCorrect usage:\n\n\tpython fisim.py -f1 <FileIn1> -f2 <FileIn2> [-o <fileOut>] [-v]"
	print "or\n\tpython fisim.py -fileList <FileIn> -o <FileOut> [-core] [-ID]"
	print "\nFirst option: fisim will be computed for the two motifs found in f1 and f2."
	print "\nSecond option: fisim will be computed pairwise for all the motifs found in fileList. The output will be a similarity matrix."	
	print "\t-core is used when one wants to compute similarities between the cores."
	print "\t-ID is used when ones want to use the ID instead of the name for motifs identification."
	print "\npython fisim -h prints this help\n"

f1 = None
f2 = None
fileList = None
out = None
verbose = False
core = False
ID = False

i = 1
while i < len(sys.argv):
	if sys.argv[i] == "-f1":
		i += 1
		f1 = sys.argv[i]
	elif sys.argv[i] == "-f2":
		i += 1
		f2 = sys.argv[i]
	elif sys.argv[i] == "-fileList":
		i += 1
		fileList = sys.argv[i]
	elif sys.argv[i] == "-o":
		i += 1
		out = sys.argv[i]
	elif sys.argv[i] == "-core":
		core = True
	elif sys.argv[i] == "-ID":
		ID = True
	elif sys.argv[i] == "-v":
		verbose = True
	elif sys.argv[i] == "-h":
		helpProgram()
		sys.exit(-1)
	else:
		print "Unknown flag " + sys.argv[i]
		helpProgram()
		sys.exit(-1)
	i+=1

if (f1 != None and f2 == None):
	print("-f2 not found")
	helpProgram()
	sys.exit(-1)

if (f1 == None and f2 != None):
	print("-f1 not found")
	helpProgram()
	sys.exit(-1)

if fileList != None and out == None:
	print("Output file not found")
	helpProgram()
	sys.exit(-1)
	

if (f1 == None and f2 == None and fileList == None):
	print("Input files not found")
	helpProgram()
	sys.exit(-1)

if f1 != None and not os.path.isfile(f1):
	print "Input file f1 " + f1 + " not found"
	sys.exit(-1)

if f2 != None and not os.path.isfile(f2):
	print "Input file f2 " + f2 + " not found"
	sys.exit(-1)

if fileList != None and not os.path.isfile(fileList):
	print "Input file fileList " + fileList + " not found"
	sys.exit(-1)


if f1 != None and f2 != None:
	m1 = Motif(fileIn = f1)
	m2 = Motif(fileIn = f2)
	#print m1
	fileOut = None
	if out != None: fileOut = open(out,'w')
	else: verbose=True
	m1.fisim(m2,fileOut=fileOut,verbose=verbose)

elif fileList != None:
	cores = []

	fileList = open(fileList)
	motifs = []
	#print utils.EOF(fileList)
	while not utils.EOF(fileList):
		m = Motif(fileIn=fileList)
		#print m
		motifs.append(m)
		print m.core(n=5)
		if core: cores.append(m.core(n=5))
	#print motifs
	utilsMatrix.createSimMatrix(motifs,cores,out,ID=ID,verbose=verbose)


else:
	helpProgram()
	sys.exit(-1)

